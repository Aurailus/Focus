(()=>{"use strict";function t(t){return t*(Math.PI/180)}const e=22,i=t(90);class s{constructor(t){this.ctx="getContext"in t?t.getContext("2d"):t,this.icons={},this.radius=this.ctx.canvas.width/2;const e=document.createElement("canvas");e.width=128,e.height=128,this.glowCtx=e.getContext("2d"),this.glowImg=null}loadImage(t){return new Promise((e=>{const i=document.createElement("img");i.onload=()=>e(i),i.src=t}))}async init(){const[t,e,i,s]=await Promise.all([this.loadImage("../res/glow.png"),this.loadImage("../res/battery.svg"),this.loadImage("../res/steps.svg"),this.loadImage("../res/heart.svg")]);this.glowImg=t,this.icons={battery:e,steps:i,heart:s}}clear(){const{ctx:t,radius:e}=this;t.clearRect(0,0,2*e,2*e)}circle(t,e,s,a,n,o){const{ctx:r,radius:c}=this;r.save(),r.translate(c,c),r.rotate(t-i),r.beginPath(),r.arc(e,0,s,0,2*Math.PI,!1),r.closePath(),a&&(r.fillStyle=a,r.fill()),n&&o&&(r.strokeStyle=n,r.lineWidth=o,r.stroke()),r.restore()}line(t,e,i,s,a){const{ctx:n,radius:o}=this;n.save(),n.translate(o,o),n.rotate(t),n.beginPath(),n.lineWidth=s,n.strokeStyle=a,n.moveTo(0,e),n.lineTo(0,i),n.stroke(),n.closePath(),n.restore()}rounded(t,e,i,s,a,n,o){const{ctx:r,radius:c}=this;r.save(),r.translate(c,c),r.rotate(t),r.beginPath(),r.moveTo(-s/2,e),r.lineTo(-s/2,i),r.quadraticCurveTo(-s/2,i+s/1.5,0,i+s/1.5),r.quadraticCurveTo(s/2,i+s/1.5,s/2,i),r.lineTo(s/2,e),r.quadraticCurveTo(s/2,e-s/1.5,0,e-s/1.5),r.quadraticCurveTo(-s/2,e-s/1.5,-s/2,e),r.closePath(),a&&(r.fillStyle=a,r.fill()),n&&o&&(r.strokeStyle=n,r.lineWidth=o,r.stroke()),r.restore()}glow(t,e,i,s){const{ctx:a,glowCtx:n,glowImg:o,radius:r}=this,c=Math.cos(t)*e,l=Math.sin(t)*e;n.fillStyle=s,n.globalCompositeOperation="source-over",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.globalCompositeOperation="destination-in",n.drawImage(o,0,0);const h=1.5*r*i;a.drawImage(n.canvas,r+c-h/2,r+l-h/2,h,h)}event(s,a){const{ctx:n,radius:o}=this;n.save(),n.translate(o,o);const r=t((s.start.getHours()%12+s.start.getMinutes()/60)/12*360+e/6-90),c=t((s.end.getHours()%12+s.end.getMinutes()/60)/12*360-2.75-90);n.beginPath(),n.fillStyle="rgba(65, 199, 232, 0.2)",n.arc(0,0,a,r,c,!1);let l=Math.cos(c+t(4.25))*a,h=Math.sin(c+t(4.25))*a,d=Math.cos(c+t(4.25))*(a-11),m=Math.sin(c+t(4.25))*(a-11);n.quadraticCurveTo(l,h,d,m),l=Math.cos(c+t(4.25))*(a-e),h=Math.sin(c+t(4.25))*(a-e),d=Math.cos(c)*(a-e),m=Math.sin(c)*(a-e),n.quadraticCurveTo(l,h,d,m),n.arc(0,0,a-e,c,r,!0),l=Math.cos(r-t(4.25))*(a-e),h=Math.sin(r-t(4.25))*(a-e),d=Math.cos(r-t(4.25))*(a-11),m=Math.sin(r-t(4.25))*(a-11),n.quadraticCurveTo(l,h,d,m),l=Math.cos(r-t(4.25))*a,h=Math.sin(r-t(4.25))*a,d=Math.cos(r)*a,m=Math.sin(r)*a,n.quadraticCurveTo(l,h,d,m),n.fill(),n.closePath(),n.restore(),this.circle(r+i,a-11,7,s.color),n.font="900 16px Arial sans-serif",n.fillStyle="#fff",n.textBaseline="top",n.textAlign="center";let g=r+i+t(6);for(let t=0;t<s.title.length;t++)n.save(),n.translate(o,o),n.rotate(g),n.fillText(s.title[t],0,2-a),n.restore(),t<s.title.length-1&&(g+=.0065*n.measureText(s.title[t]).width/2+.0065*n.measureText(s.title[t+1]).width/2)}}const a="rgba(65, 199, 232, 0.33)",n="rgba(65, 199, 232, 0.5)";class o{constructor(t){this.artist=t,this.animStep=0,this.ambient=!1,this.theme={notchMode:3,notchModeAmbient:2,showEvents:!0,showMinutes:!0,showGlow:!0,glowColors:["rgba(172, 77, 255, 1)","rgba(255, 54, 134, 0.4)","rgba(255, 71, 249, 0.6)"],complications:[null,{type:"heartrate",style:1},{type:"date",style:1},{type:"battery",style:1}]},this.events=function(){const t=(t,e)=>{const i=new Date;return i.setHours(t,e,0),i};return[{start:t(9,30),end:t(11,20),color:"#59acff",title:"Japanese"},{start:t(12,30),end:t(1,20),color:"#59acff",title:"Stats"},{start:t(1,30),end:t(2,20),color:"#59acff",title:"Math"}]}(),window.addEventListener("timetick",(()=>this.draw())),window.addEventListener("ambientmodechanged",(t=>{const e=t.detail.ambientMode;this.ambient!==e&&(this.ambient=e,this.draw())})),document.addEventListener("visibilitychange",(()=>{document.hidden||this.draw()})),this.draw()}clearPendingDraw(){void 0!==this.animTimeout&&window.clearTimeout(this.animTimeout),this.animTimeout=void 0,void 0!==this.animReq&&window.cancelAnimationFrame(this.animReq),this.animReq=void 0}getTime(){try{return tizen.time.getCurrentDateTime()}catch(t){return new Date}}drawComplication(e,i,s){const{artist:a}=this,n=a.radius/2,o=t(90*e),r=Math.cos(o-t(90))*n,c=Math.sin(o-t(90))*n;s>0&&a.circle(o,n,40,2===s?this.ambient?"#aaa":"#777":void 0,1===s?this.ambient?"#777":"#444":void 0,3),a.ctx.save(),a.ctx.translate(a.radius,a.radius);const l=(t,e)=>s>1?`rgba(0, 0, 0, ${(s<2&&e||t)*(this.ambient?2:1)})`:`rgba(255, 255, 255, ${(s<2&&e||t)*(this.ambient?2:1)})`;switch(i){case"date":const t=this.getTime();a.ctx.font="900 20px Arial sans-serif",a.ctx.fillStyle=l(.9,.7),a.ctx.textBaseline="bottom",a.ctx.textAlign="center",a.ctx.fillText(`${["SUN","MON","TUE","WED","THU","FRI","SAT"][t.getDay()]}`,r,c-2),a.ctx.fillStyle=l(.6,.2),a.ctx.fillRect(r-20,c-1,40,3),a.ctx.fillStyle=l(.9,.7),a.ctx.font="900 24px Arial sans-serif",a.ctx.fillText(`${t.getDate()}`,r,c+31);break;case"battery":const e=50;a.ctx.drawImage(a.icons.battery,r-18,c-18-14,36,36),a.ctx.font="900 24px Arial sans-serif",a.ctx.textBaseline="top",a.ctx.textAlign="center",a.ctx.fillStyle=l(.9,.7),a.ctx.fillText(e.toString(),r,c+4);break;case"steps":const i=1800;a.ctx.drawImage(a.icons.steps,r-18,c-18-14,36,36),a.ctx.font="900 22px Arial sans-serif",a.ctx.textBaseline="top",a.ctx.textAlign="center",a.ctx.fillStyle=l(.9,.7),a.ctx.fillText(i.toString(),r,c+4);break;case"heartrate":const s=85;a.ctx.drawImage(a.icons.heart,r-18,c-18-14,36,36),a.ctx.font="900 24px Arial sans-serif",a.ctx.textBaseline="top",a.ctx.textAlign="center",a.ctx.fillStyle=l(.9,.7),a.ctx.fillText(s.toString(),r,c+4)}a.ctx.restore()}draw(){const{artist:e,theme:i,events:s}=this;this.clearPendingDraw(),e.clear();const o=this.getTime();for(let t=0;t<4;t++){let e=i.complications[t];null!==e&&this.drawComplication(t,e.type,e.style)}if(!this.ambient&&i.showGlow){this.animStep=(this.animStep+1)%360;let s=.8+Math.sin(t(this.animStep+180))/6,a=.8+Math.cos(t(this.animStep))/6,n=1.2+Math.sin(t(3*this.animStep+90))/6,o=50*Math.cos(t(3*this.animStep));e.ctx.globalCompositeOperation="lighter",e.glow(t(this.animStep),o,s,i.glowColors[1]),e.glow(0,0,n,i.glowColors[0]),e.glow(t(this.animStep+180),o,a,i.glowColors[2]),e.ctx.globalCompositeOperation="source-over"}const r=this.ambient?i.notchModeAmbient:i.notchMode,c=0===i.notchModeAmbient?2:8;if(0!==r)for(let i=0;i<60;i++)i%5==0&&r>=2||i%15==0&&r>=1?e.circle(t(i/60*360-90),e.radius-c-4,3,this.ambient?n:a):r>=3&&e.circle(t(i/60*360-90),e.radius-c-4,2,this.ambient?a:"rgba(65, 199, 232, 0.15)");if(i.showEvents)for(let t of s){let s=c+(0!==i.notchMode?12:0);e.event(t,e.radius-s)}if(e.circle(0,0,18,a),e.circle(0,0,10,"#fff"),i.showMinutes){const i=t((o.getMinutes()+o.getSeconds()/60)/60*360-180);e.rounded(i,38,e.radius-56,12,n)}const l=t((o.getHours()%12+o.getMinutes()/60)/12*360-180);e.rounded(l,42,e.radius-80,16,"rgba(0, 0, 0, 0.15)","#fff",4),this.ambient||(this.animTimeout=setTimeout((()=>this.animReq=window.requestAnimationFrame((()=>this.draw()))),100))}}(async()=>{await new Promise((t=>window.onload=()=>t()));const t=document.querySelector("canvas");t.width=document.body.clientWidth,t.height=t.width;const e=new s(t);await e.init(),new o(e)})()})();