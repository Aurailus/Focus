(()=>{"use strict";function t(t){return t*(Math.PI/180)}const e=22;class i{constructor(t){this.ctx="getContext"in t?t.getContext("2d"):t,this.radius=this.ctx.canvas.width/2;const e=document.createElement("canvas");e.width=128,e.height=128,this.glowCtx=e.getContext("2d"),this.glowImg=null}init(){return new Promise((t=>{this.glowImg=document.createElement("img"),this.glowImg.onload=()=>t(),this.glowImg.src="../res/glow.png"}))}clear(){const{ctx:t,radius:e}=this;t.clearRect(0,0,2*e,2*e)}circle(t,e,i,a){const{ctx:s,radius:o}=this;s.save(),s.translate(o,o),s.rotate(t),s.beginPath(),s.arc(e,0,i,0,2*Math.PI,!1),s.fillStyle=a,s.fill(),s.closePath(),s.restore()}line(t,e,i,a,s){const{ctx:o,radius:n}=this;o.save(),o.translate(n,n),o.rotate(t),o.beginPath(),o.lineWidth=a,o.strokeStyle=s,o.moveTo(0,e),o.lineTo(0,i),o.stroke(),o.closePath(),o.restore()}rounded(t,e,i,a,s,o,n){const{ctx:r,radius:c}=this;r.save(),r.translate(c,c),r.rotate(t),r.beginPath(),r.moveTo(-a/2,e),r.lineTo(-a/2,i),r.quadraticCurveTo(-a/2,i+a/1.5,0,i+a/1.5),r.quadraticCurveTo(a/2,i+a/1.5,a/2,i),r.lineTo(a/2,e),r.quadraticCurveTo(a/2,e-a/1.5,0,e-a/1.5),r.quadraticCurveTo(-a/2,e-a/1.5,-a/2,e),r.closePath(),s&&(r.fillStyle=s,r.fill()),o&&n&&(r.strokeStyle=o,r.lineWidth=n,r.stroke()),r.restore()}glow(t,e,i,a){const{ctx:s,glowCtx:o,glowImg:n,radius:r}=this,c=Math.cos(t)*e,l=Math.sin(t)*e;o.fillStyle=a,o.globalCompositeOperation="source-over",o.fillRect(0,0,o.canvas.width,o.canvas.height),o.globalCompositeOperation="destination-in",o.drawImage(n,0,0);const h=1.5*r*i;s.drawImage(o.canvas,r+c-h/2,r+l-h/2,h,h)}event(i,a){const{ctx:s,radius:o}=this;s.save(),s.translate(o,o);const n=t((i.start.getHours()%12+i.start.getMinutes()/60)/12*360+e/6-90),r=t((i.end.getHours()%12+i.end.getMinutes()/60)/12*360-2.75-90);s.beginPath(),s.fillStyle="rgba(65, 199, 232, 0.2)",s.arc(0,0,a,n,r,!1);let c=Math.cos(r+t(4.25))*a,l=Math.sin(r+t(4.25))*a,h=Math.cos(r+t(4.25))*(a-11),d=Math.sin(r+t(4.25))*(a-11);s.quadraticCurveTo(c,l,h,d),c=Math.cos(r+t(4.25))*(a-e),l=Math.sin(r+t(4.25))*(a-e),h=Math.cos(r)*(a-e),d=Math.sin(r)*(a-e),s.quadraticCurveTo(c,l,h,d),s.arc(0,0,a-e,r,n,!0),c=Math.cos(n-t(4.25))*(a-e),l=Math.sin(n-t(4.25))*(a-e),h=Math.cos(n-t(4.25))*(a-11),d=Math.sin(n-t(4.25))*(a-11),s.quadraticCurveTo(c,l,h,d),c=Math.cos(n-t(4.25))*a,l=Math.sin(n-t(4.25))*a,h=Math.cos(n)*a,d=Math.sin(n)*a,s.quadraticCurveTo(c,l,h,d),s.fill(),s.closePath(),s.restore(),this.circle(n,a-11,7,i.color),s.font="900 16px Arial sans-serif",s.fillStyle="#fff",s.textBaseline="top",s.textAlign="center";let u=n+t(96);for(let t=0;t<i.title.length;t++)s.save(),s.translate(o,o),s.rotate(u),s.fillText(i.title[t],0,2-a),s.restore(),t<i.title.length-1&&(u+=.0065*s.measureText(i.title[t]).width/2+.0065*s.measureText(i.title[t+1]).width/2)}}const a="rgba(65, 199, 232, 0.33)",s="rgba(65, 199, 232, 0.8)";class o{constructor(t){this.artist=t,this.animStep=0,this.ambient=!1,this.theme={notchMode:3,showEvents:!0,showMinutes:!0,showGlow:!0,glowColors:["#4294ff","rgba(5, 124, 242, 0.6)","rgba(198, 0, 237, 1)"]},this.events=function(){const t=(t,e)=>{const i=new Date;return i.setHours(t,e,0),i};return[{start:t(9,30),end:t(11,20),color:"#59acff",title:"PAAS"},{start:t(12,30),end:t(1,20),color:"#59acff",title:"STAT"},{start:t(1,30),end:t(2,20),color:"#59acff",title:"MATH"}]}(),window.addEventListener("timetick",(()=>this.draw())),window.addEventListener("ambientmodechanged",(t=>{const e=t.detail.ambientMode;this.ambient!==e&&(this.ambient=e,this.draw())})),document.addEventListener("visibilitychange",(()=>{document.hidden||this.draw()})),this.draw()}clearPendingDraw(){void 0!==this.animTimeout&&window.clearTimeout(this.animTimeout),this.animTimeout=void 0,void 0!==this.animReq&&window.cancelAnimationFrame(this.animReq),this.animReq=void 0}getTime(){try{return tizen.time.getCurrentDateTime()}catch(t){return new Date}}draw(){const{artist:e,theme:i,events:o}=this;this.clearPendingDraw(),e.clear();const n=this.getTime();if(e.ctx.font="900 20px Arial sans-serif",e.ctx.fillStyle="#aaa",e.ctx.textBaseline="bottom",e.ctx.textAlign="center",e.ctx.fillText(`${["SUN","MON","TUE","WED","THU","FRI","SAT"][n.getDay()]} ${n.getDate()}`,e.radius,e.radius+e.radius/1.75),e.ctx.fillStyle="#666",e.ctx.fillRect(e.radius-20,e.radius+e.radius/1.75+2,40,2),!this.ambient&&i.showGlow){this.animStep=(this.animStep+1)%360;let a=.8+Math.sin(t(this.animStep+180))/6,s=.8+Math.cos(t(this.animStep))/6,o=1.2+Math.sin(t(3*this.animStep+90))/6,n=50*Math.cos(t(3*this.animStep));e.ctx.globalCompositeOperation="lighter",e.glow(t(this.animStep),n,a,i.glowColors[1]),e.glow(0,0,o,i.glowColors[0]),e.glow(t(this.animStep+180),n,s,i.glowColors[2]),e.ctx.globalCompositeOperation="source-over"}if(0!==i.notchMode)for(let o=0;o<60;o++)o%15==0?e.circle(t(o/60*360),e.radius-2-4,4,s):o%5==0&&i.notchMode>=2?e.circle(t(o/60*360-90),e.radius-2-4,3,a):i.notchMode>=3&&e.circle(t(o/60*360-90),e.radius-2-4,2,"rgba(65, 199, 232, 0.15)");if(i.showEvents)for(let t of o){let a=2+i.notchMode!==0?12:0;e.event(t,e.radius-a)}if(e.circle(0,0,18,a),e.circle(0,0,10,"#fff"),i.showMinutes){const i=t((n.getMinutes()+n.getSeconds()/60)/60*360-180);e.rounded(i,40,e.radius-64,16,s)}const r=t((n.getHours()%12+n.getMinutes()/60)/12*360-180);e.rounded(r,42,e.radius-92,16,"rgba(0, 0, 0, 0.15)","#fff",4),this.ambient||(this.animTimeout=setTimeout((()=>this.animReq=window.requestAnimationFrame((()=>this.draw()))),100))}}(async()=>{await new Promise((t=>window.onload=()=>t()));const t=document.querySelector("canvas");t.width=document.body.clientWidth,t.height=t.width;const e=new i(t);await e.init(),new o(e)})()})();